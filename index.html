<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>MyBaby</title>
		<link href="css/bootstrap.min.css" rel="stylesheet">
        <link href="css/ripples.min.css" rel="stylesheet">
        <link href="css/material-wfont.min.css" rel="stylesheet">
		<link href="css/custom.css" rel="stylesheet">
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="js-plots/excanvas.min.js"></script><![endif]-->
	</head>
	<body>
	
		<nav class="navbar navbar-material-purple navbar-fixed-top" role="navigation">
		  <div class="container">
			<div class="navbar-header">
			  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			  </button>
			  <a class="navbar-brand" href="#">MyBaby</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
			  <ul class="nav navbar-nav">
				<li class="active"><a href="#">Home</a><span class="sr-only">(current)</span></li>
				<li><a href="#about">About</a></li>
				<li class="dropdown">
				  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Dropdown <span class="caret"></span></a>
				  <ul class="dropdown-menu" role="menu">
					<li><a href="#">Action</a></li>
					<li><a href="#">Another action</a></li>
					<li><a href="#">Something else</a></li>
				  </ul>
				</li>
			  </ul>
			  <ul class="nav navbar-nav navbar-right">
				<li id="insMan"><a href="#">Ins. manuale</a></li>
			  </ul>
			</div>
		  </div>
		</nav>
		
		<div class="container">
		
			<div class="row">
				<div class="col-lg-12 col-md-12 col-xs-12">
					<form id="uploadimage" class="well bs-component" method="post" enctype="multipart/form-data">
						<div class="input-group">
							<div class="form-control-wrapper fileinput">
								<input class="form-control empty purple" type="text" readonly="">
								<input id="inputFile" type="file" name="file">
								<div class="floating-label">Scegli immagine</div>
								<span class="material-input"></span>
							</div>
							<span class="input-group-btn">
								<button type="submit" class="btn btn-material-purple">carica</button>
							</span>
						</div>
					</form>
				</div>
			</div>

			<div class="row loader">
				<div class="col-lg-12 col-md-12 col-xs-12">
					<img src="images/loader.svg" />
				</div>
			</div>
			
			<div class="row manual">
				<div class="col-lg-12 col-md-12 col-xs-12">
					<form id="insert" class="well form-horizontal" method="post">
						<fieldset>
							<legend>Inserimento manuale</legend>
							<div class="form-group">
								<label for="inputName" class="col-lg-1 control-label">Nome</label>
								<div class="col-lg-11">
									<div class="form-control-wrapper">
										<input class="form-control empty" id="inputName"/>
										<span class="material-input material-input-purple"></span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="inputType" class="col-lg-1 control-label">Esame</label>
								<div class="col-lg-3">
									<div class="form-control-wrapper">
										<select class="form-control" id="inputType">
											<option>AC</option>
											<option>BPD</option>
											<option>FL</option>
											<option>HC</option>
										</select>
										<span class="material-input material-input-purple"></span>
									</div>
								</div>
								<label for="inputWeek" class="col-lg-1 control-label">Settimana</label>
								<div class="col-lg-3">
									<div class="form-control-wrapper">
										<input class="form-control empty" id="inputWeek" type="number" min="14" max="41" step="1" value="14"/>
										<span class="material-input material-input-purple"></span>
									</div>
								</div>
								<label for="inputValue" class="col-lg-1 control-label">Valore</label>
								<div class="col-lg-3">
									<div class="form-control-wrapper">
										<input class="form-control empty" id="inputValue" type="number" min="0" max="50" step="0.01" />
										<span class="material-input material-input-purple"></span>
									</div>
								</div>
							</div>
						</fieldset>
						<div class="form-group">
							<div class="col-lg-12 col-md-12 col-xs-12 toright">
								<div class="input-group">
									<span class="input-group-btn">
										<button type="submit" class="btn btn-material-purple">carica</button>
									</span>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
			
			<div class="row graphs">
				<div class="col-lg-6 col-md-12 col-xs-12">
					<h4 id="graph0_title" class="title"></h4>
					<div id="graph0" class="plot"></div>
				</div>
				<div  class="col-lg-6 col-md-12 col-xs-12">
					<h4 id="graph1_title" class="title"></h4>
					<div id="graph1" class="plot"></div>
				</div>
			</div>
			
			<div class="row error">
				<div class="col-lg-12 col-md-12 col-xs-12">
					<div class="well well-material-red bs-component">
						<span id="log-message"></span>
					</div>
				</div>
			</div>
		
		</div>
			
		<div id="init" class="modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">ATTENZIONE</h4>
					</div>
					<div class="modal-body">
						<p>
							Il software &egrave; in fase pre-produzione e protrebbe presentare problemi inaspettati.
							<br/>
							Non fate totale affidamento su di esso, ma rivolgetevi sempre ad uno specialista.
						</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">no grazie</button>
						<button type="button" class="btn btn-material-purple" data-dismiss="modal">accetto</button>
					</div>
				</div>
			</div>
		</div>
	
		<script src="js/jquery-1.10.2.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
		<script src="js/ripples.min.js"></script>
        <script src="js/material.min.js"></script>
		<script src="js-plots/jquery.flot.min.js"></script>
		<script src="js-plots/data.js"></script>
		
		<script>
            $(function() {
				$.material.init();
				$('#uploadimage')[0].reset();
            });
			
			$(window).load(function(){
				$('#init').modal('show');
			});
        </script>
		
		<script>
			$(document).ready(function (e) {
			
				var validFile = false;
			
				$('.fileinput #inputFile').change(function() {
					$('.fileinput .floating-label').empty();
					$('.fileinput .empty').val($(this).val());
					$('.error').css('display', 'none');
					$('.error #log-message').empty();
					$('#insert')[0].reset();
					$('.manual').css('display', 'none');
					$('.graphs').css('display', 'none');
					for (var index = 0; index < 2; index++) {
						$('#graph'+index).empty();
						$('#graph'+index+'_title').text('');
						$('#graph'+index).css('display', 'none');
					}
					var filetype = this.files[0].type;
					var match = ['image/jpeg', 'image/jpg'];
					if(!((filetype==match[0]) || (filetype==match[1]))) {
						$('.error #log-message').text('Seleziona un file immagine valido con estensione jpeg o jpg.');
						$('.error').css('display', 'block');
						$('.fileinput .empty').text('');
						$('.fileinput .floating-label').html('Scegli immagine');
						validFile = false;
					} else {
						$('.error').css('display', 'none');
						$('.fileinput .floating-label').html('');
						validFile = true;
					}
				});
			
				$('#uploadimage').on('submit', function(e) {
					e.preventDefault();
					if (validFile) {
						$('.loader').css('display', 'block');
						$('.error #log-message').empty();
						$.ajax({
							url: 'json.php',
							type: 'POST',
							data: new FormData(this),
							contentType: false,
							cache: false,
							processData: false,
							success: function(data) {
								$('.error').css('display', 'block');
								$('.error #log-message').html(data);
								$('.loader').css('display', 'none');
								var obj = $.parseJSON(data);
								if (obj != '') {
									$('.graphs').css('display', 'block');
									$.each(obj.values, function( index, value ) {
										$('#graph'+index).css('display', 'block');
										$('#graph'+index+'_title').text(value[0] + ': ' + value[1]);
										draw_graph('#graph'+index, value[0], value[3].substring(0,2) + '.' + Math.round(value[3].substring(3,4) * 10/7), value[1]);
									});
								} else {
									$('.error #log-message').text('Si Ã¨ verificato un errore nell\'elaborazione del file.');
									$('#insert')[0].reset();
									$('.manual').css('display', 'block');
								}
							}
						});
					}
				});
				
				$('#insMan').on('click', function(e) {
					e.preventDefault();
					$('#insert')[0].reset();
					$('.graphs').css('display', 'none');
					for (var index = 0; index < 2; index++) {
						$('#graph'+index).empty();
						$('#graph'+index+'_title').text('');
						$('#graph'+index).css('display', 'none');
					}
					$('.error #log-message').text('');
					$('.error').css('display', 'none');
					$('.manual').css('display', 'block');
				});
				
				$('#insert').on('submit', function(e) {
					e.preventDefault();
					$('.graphs').css('display', 'block');
					$('#graph0').css('display', 'block');
					$('#graph0_title').text($('#inputType').val() + ': ' + $('#inputValue').val());
					draw_graph('#graph0', $('#inputType').val(), $('#inputWeek').val(), $('#inputValue').val());
					$('.manual').css('display', 'none');
					
					var res = 0;
					switch ($('#inputType').val()) {
						case 'AC':
							res = $('#inputValue').val() / AC_data.med[$('#inputWeek').val()-14] * 100;
							break;
						case 'BPD':
							res = $('#inputValue').val() / BPD_data.med[$('#inputWeek').val()-14] * 100;
							break;
						case 'FL':
							res = $('#inputValue').val() / FL_data.med[$('#inputWeek').val()-14] * 100;
							break;
						case 'HC':
							res = $('#inputValue').val() / HC_data.med[$('#inputWeek').val()-14] * 100;
							break;
					}
					
					$('.error #log-message').text('{"name":"' + $('#inputName').val() + '","values":[["' + $('#inputType').val() + '","' + $('#inputValue').val() + '","cm","' + $('#inputWeek').val() + '","' + parseFloat(res).toFixed(2) + '"]]}');
					$('.error').css('display', 'block');
				});
				
			});
		</script>
	
	</body>
</html>